<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>物理シミュレーションゲーム</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Matter.js の読み込み -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <script>
    // モジュールのエイリアスを作成
    const Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Mouse = Matter.Mouse,
          MouseConstraint = Matter.MouseConstraint;

    // エンジンの作成
    const engine = Engine.create();
    const world = engine.world;

    // レンダラの作成
    const render = Render.create({
      element: document.body,
      engine: engine,
      options: {
        width: 800,
        height: 600,
        wireframes: false,
        background: '#fafafa'
      }
    });
    Render.run(render);

    // ランナーの作成
    const runner = Runner.create();
    Runner.run(runner, engine);

    // 地面の作成
    const ground = Bodies.rectangle(400, 590, 810, 60, { isStatic: true });
    Composite.add(world, ground);

    // 左右の壁を作成
    const leftWall = Bodies.rectangle(0, 300, 50, 600, { isStatic: true });
    const rightWall = Bodies.rectangle(800, 300, 50, 600, { isStatic: true });
    Composite.add(world, [leftWall, rightWall]);

    // クリックでボールを追加する処理
    document.addEventListener('mousedown', (event) => {
      const ball = Bodies.circle(event.clientX, event.clientY, 20, {
        restitution: 0.9  // 反発係数（跳ね返り具合）
      });
      Composite.add(world, ball);
    });

    // マウス操作の追加（ドラッグで物体を操作可能）
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: {
        stiffness: 0.2,
        render: { visible: false }
      }
    });
    Composite.add(world, mouseConstraint);

    // レンダラとマウスの同期
    render.mouse = mouse;
  </script>
</body>
</html>
